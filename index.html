<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>马耳他假期行程（2025年12月22日–2026年1月2日）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: #154c79;
      --primary-light: #1f6aa6;
      --bg: #f7f7f7;
      --card-bg: #ffffff;
      --border: #e0e0e0;
      --text-main: #222;
      --text-sub: #666;
      --accent: #ffb347;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC",
                   "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }
    header {
      background: var(--primary);
      color: #fff;
      padding: 16px 12px 12px;
      text-align: center;
    }
    header h1 {
      margin: 0 0 6px;
      font-size: 20px;
      font-weight: 600;
    }
    header p {
      margin: 0;
      font-size: 13px;
      opacity: 0.9;
    }
    .container {
      max-width: 900px;
      margin: 16px auto 24px;
      padding: 0 10px;
    }
    .date-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
      justify-content: flex-start;
    }
    .date-btn {
      border: 1px solid var(--border);
      background: #fff;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      color: var(--text-sub);
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    .date-btn.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
      box-shadow: 0 2px 4px rgba(0,0,0,0.12);
    }
    .itinerary {
      display: none;
      background: var(--card-bg);
      border-radius: 8px;
      padding: 14px 12px 16px;
      border: 1px solid var(--border);
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      margin-bottom: 12px;
    }
    .itinerary.active {
      display: block;
    }
    .day-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 8px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 6px;
    }
    .activity {
      display: flex;
      padding: 5px 0;
      border-bottom: 1px dashed #eee;
    }
    .activity:last-child {
      border-bottom: none;
    }
    .time {
      flex: 0 0 52px;
      font-weight: 600;
      font-size: 12px;
      color: var(--primary-light);
    }
    .desc {
      flex: 1;
      font-size: 13px;
      color: var(--text-main);
    }
    .desc small {
      display: block;
      color: var(--text-sub);
      font-size: 11px;
      margin-top: 2px;
    }

    /* 额外景点 & 历史背景模块样式 */
    .extra-block,
    .history-block {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px solid #eee;
    }
    .extra-title,
    .history-title-main {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }
    .extra-title span.hint,
    .history-title-main span.hint {
      font-size: 11px;
      font-weight: 400;
      color: var(--text-sub);
    }
    .extra-item {
      margin: 4px 0 6px;
      font-size: 13px;
    }
    .extra-item a {
      font-weight: 600;
      display: inline-block;
      margin-right: 4px;
    }
    .extra-text {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .history-card {
      border-radius: 6px;
      border: 1px solid #eee;
      padding: 8px 8px 6px;
      margin-bottom: 6px;
      background: #fafafa;
    }
    .history-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .history-text {
      font-size: 12px;
      line-height: 1.7;
      color: var(--text-main);
      margin: 0 0 4px;
    }
    .history-actions {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }
    .speak-btn {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 4px;
      border: 1px solid var(--primary-light);
      background: #fff;
      color: var(--primary-light);
      cursor: pointer;
    }
    .speak-btn:hover {
      background: var(--primary-light);
      color: #fff;
    }
    .speak-stop {
      border-color: #999;
      color: #666;
    }
    .speak-stop:hover {
      background: #666;
      color: #fff;
    }
    .detail-link {
      font-size: 11px;
      color: var(--primary-light);
      text-decoration: none;
    }
    .detail-link:hover {
      text-decoration: underline;
    }

    a {
      color: var(--primary-light);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    @media (max-width: 600px) {
      header h1 { font-size: 18px; }
      .time { flex-basis: 48px; }
      .activity { padding: 4px 0; }
      .history-text { font-size: 12px; }
    }
  </style>
</head>
<body>
<header>
  <h1>马耳他假期行程</h1>
  <p>2025年12月22日 – 2026年1月2日 · Valletta + Balluta Bay（Malta Marriott）</p>
</header>

<div class="container">
  <div id="date-buttons" class="date-buttons"></div>
  <div id="itineraries"></div>
</div>

<script>
  // ====== 正常行程时间轴数据 ======
  const itineraryData = {
    "2025-12-22": [
      {
        time: "18:50",
        html: `抵达 <a href="https://www.google.com/maps/search/?api=1&query=Malta+International+Airport" target="_blank" rel="noopener noreferrer">Malta International Airport</a>（马耳他国际机场）。`
      },
      {
        time: "19:20",
        html: `乘坐出租车前往酒店 <a href="https://www.google.com/maps/search/?api=1&query=Domus+Zamittello+Valletta" target="_blank" rel="noopener noreferrer">Domus Zamittello</a>，车程约15–20分钟，费用约€17–20。`
      },
      {
        time: "20:00",
        html: `办理入住，整理行李，在房间稍作休息。`
      },
      {
        time: "21:00",
        html: `如果不太累，可以从酒店步行在瓦莱塔老城简单走一圈：City Gate → Republic Street → <a href="https://www.google.com/maps/search/?api=1&query=Upper+Barrakka+Gardens+Valletta" target="_blank" rel="noopener noreferrer">Upper Barrakka Gardens</a>，总步行时间约30–40分钟。`
      },
      {
        time: "21:15",
        html: `晚餐备选 1：<a href="https://www.google.com/maps/search/?api=1&query=Rampila+Restaurant+Valletta" target="_blank" rel="noopener noreferrer">Rampila</a> —— 地中海 / 马耳他菜，带城墙露台景观；从酒店步行约6–8分钟；谷歌评分约4.4★；人均约€40–50。`
      },
      {
        time: "21:16",
        html: `晚餐备选 2：<a href="https://www.google.com/maps/search/?api=1&query=Nenu+the+Artisan+Baker+Valletta" target="_blank" rel="noopener noreferrer">Nenu the Artisan Baker</a> —— 马耳他家常菜 / 烤饼；从酒店步行约8分钟；谷歌评分约4.4★；人均约€20–30。`
      },
      {
        time: "21:17",
        html: `晚餐备选 3：<a href="https://www.google.com/maps/search/?api=1&query=The+Harbour+Club+Valletta" target="_blank" rel="noopener noreferrer">The Harbour Club</a> —— 现代地中海料理，港景露台；从酒店步行约10分钟；谷歌评分约4.4★；人均约€35–45。`
      }
    ],

    "2025-12-23": [
      {
        time: "10:30",
        html: `从 <a href="https://www.google.com/maps/search/?api=1&query=Domus+Zamittello+Valletta" target="_blank" rel="noopener noreferrer">Domus Zamittello</a> 出发，步行穿过 City Gate，前往 <a href="https://www.google.com/maps/search/?api=1&query=Upper+Barrakka+Gardens+Valletta" target="_blank" rel="noopener noreferrer">Upper Barrakka Gardens</a>，俯瞰 Grand Harbour。步行约10分钟。`
      },
      {
        time: "11:30",
        html: `沿 Republic Street 慢慢向下走，经过 <a href="https://www.google.com/maps/search/?api=1&query=Old+Mint+Street+Valletta" target="_blank" rel="noopener noreferrer">Old Mint Street</a> 一带小巷，感受老城石墙与阳台。`
      },
      {
        time: "12:45",
        html: `午餐备选 1：<a href="https://www.google.com/maps/search/?api=1&query=Soul+Food+Valletta" target="_blank" rel="noopener noreferrer">Soul Food</a> —— 健康 / 素食为主；距旧城步行约5–7分钟；谷歌评分约4.6★；人均约€15–25。`
      },
      {
        time: "12:46",
        html: `午餐备选 2：<a href="https://www.google.com/maps/search/?api=1&query=Rubino+Restaurant+Valletta" target="_blank" rel="noopener noreferrer">Rubino</a> —— 传统马耳他 + 意大利菜；从酒店步行约6分钟；谷歌评分约4.5★；人均约€30–40。`
      },
      {
        time: "12:47",
        html: `午餐备选 3：<a href="https://www.google.com/maps/search/?api=1&query=Beati+Paoli+Restaurant+Valletta" target="_blank" rel="noopener noreferrer">Beati Paoli</a> —— 地中海 / 海鲜；步行约6–8分钟；谷歌评分约4.5★；人均约€25–35。`
      },
      {
        time: "14:30",
        html: `午餐后在 <a href="https://www.google.com/maps/search/?api=1&query=St+John%27s+Co-Cathedral+Valletta" target="_blank" rel="noopener noreferrer">St John's Co‑Cathedral</a> 内部参观（尽量选择非弥撒时段），再随意逛逛老城小店。`
      },
      {
        time: "17:00",
        html: `回酒店稍作休息，整理着装，准备前往晚餐。`
      },
      {
        time: "18:15",
        html: `步行前往晚餐餐厅 <a href="https://www.google.com/maps/search/?api=1&query=ION+Harbour+Malta" target="_blank" rel="noopener noreferrer">ION Harbour</a>（位于 Iniala Harbour House 顶楼），从酒店步行约10–12分钟，预留时间拍一下港口黄昏景色。`
      },
      {
        time: "18:30",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=ION+Harbour+Malta" target="_blank" rel="noopener noreferrer">ION Harbour</a> 享用米其林二星晚餐（已预订 18:30–21:00），建议选择 tasting menu，预计人均消费 €200+。`
      },
      {
        time: "21:15",
        html: `晚餐后步行回 City Gate 一带，顺路逛 <a href="https://www.google.com/maps/search/?api=1&query=Triton+Fountain+Valletta" target="_blank" rel="noopener noreferrer">Triton Fountain</a> 旁的 Fairyland Santa's City 圣诞城与圣诞市集，体验游乐项目与摊位小吃。`
      }
    ],

    "2025-12-24": [
      {
        time: "10:30",
        html: `从酒店出发，步行前往 Upper Barrakka 电梯（约8分钟），乘电梯下到海滨。`
      },
      {
        time: "11:00",
        html: `在 Valletta Waterfront 乘坐渡轮前往三姐妹城一带，在 <a href="https://www.google.com/maps/search/?api=1&query=Vittoriosa+Birgu+Malta" target="_blank" rel="noopener noreferrer">Vittoriosa (Birgu)</a> 登岸。渡轮航程约10–15分钟，单程船票约€2。`
      },
      {
        time: "11:15",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Vittoriosa+Birgu+Malta" target="_blank" rel="noopener noreferrer">Birgu</a> 老城小巷、海滨长廊漫步，可顺路走到 <a href="https://www.google.com/maps/search/?api=1&query=Fort+St+Angelo+Malta" target="_blank" rel="noopener noreferrer">Fort St Angelo</a> 外观。`
      },
      {
        time: "13:00",
        html: `午餐备选 1（Birgu）：<a href="https://www.google.com/maps/search/?api=1&query=Don+Berto+Birgu" target="_blank" rel="noopener noreferrer">Don Berto</a> —— 海鲜 / 地中海菜，位于码头边；从 Birgu 核心区步行约5–8分钟；谷歌评分约4.3★；人均约€30–40。`
      },
      {
        time: "13:01",
        html: `午餐备选 2（Birgu）：<a href="https://www.google.com/maps/search/?api=1&query=Tal-Petut+Birgu" target="_blank" rel="noopener noreferrer">Tal‑Petut</a> —— 传统马耳他菜；步行约5分钟；谷歌评分约4.6★；人均约€30–40。`
      },
      {
        time: "15:30",
        html: `乘渡轮返回瓦莱塔（约15分钟），乘电梯回老城，回酒店休息，为晚上活动和子夜弥撒养精蓄锐。`
      },
      {
        time: "18:00",
        html: `晚餐：前往 <a href="https://www.google.com/maps/search/?api=1&query=Noni+Restaurant+Valletta" target="_blank" rel="noopener noreferrer">Noni</a>（米其林一星，已预订 18:00–20:45），从酒店步行约6–8分钟。预计人均 €120–150。`
      },
      {
        time: "21:30",
        html: `晚餐后回酒店稍作整理，准备前往 <a href="https://www.google.com/maps/search/?api=1&query=St+John%27s+Co-Cathedral+Valletta" target="_blank" rel="noopener noreferrer">St John's Co‑Cathedral</a> 参加圣诞子夜弥撒。步行约6–8分钟，建议提前至少30分钟到达找到座位。`
      },
      {
        time: "23:00",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=St+John%27s+Co-Cathedral+Valletta" target="_blank" rel="noopener noreferrer">St John's Co‑Cathedral</a> 参加子夜弥撒（具体时间以教堂当年公布为准），预计跨到25日0点左右结束。`
      },
      {
        time: "00:15",
        html: `从教堂步行返回酒店，注意街道人流和个人物品安全。`
      }
    ],

    "2025-12-25": [
      {
        time: "10:30",
        html: `圣诞节早上晚起，在酒店附近找一家咖啡馆做 Brunch，节日当天很多店铺不开门，可提前前一天确认营业时间。`
      },
      {
        time: "12:00",
        html: `在瓦莱塔老城随意漫步，重点可以再走一圈主要广场和教堂区域，看看本地家庭的圣诞装饰与马槽。`
      },
      {
        time: "13:00",
        html: `午餐备选 1：<a href="https://www.google.com/maps/search/?api=1&query=Caffe+Cordina+Valletta" target="_blank" rel="noopener noreferrer">Caffe Cordina</a> —— 经典马耳他咖啡馆；从酒店步行约3分钟；谷歌评分约4.3★；人均约€15–25。`
      },
      {
        time: "13:01",
        html: `午餐备选 2：<a href="https://www.google.com/maps/search/?api=1&query=King%27s+Own+Band+Club+Bar+%26+Restaurant+Valletta" target="_blank" rel="noopener noreferrer">King's Own Band Club</a> —— 本地人常去的小酒馆风餐厅；步行约4–5分钟；谷歌评分约4.4★；人均约€15–25。`
      },
      {
        time: "15:00",
        html: `下午可步行至 Marsamxett 一侧码头乘渡轮前往 <a href="https://www.google.com/maps/search/?api=1&query=Sliema+Ferries+Malta" target="_blank" rel="noopener noreferrer">Sliema Ferries</a>，船程约10–15分钟，单程约€2，在 Sliema 海滨长廊散步、喝咖啡。`
      },
      {
        time: "17:00",
        html: `乘渡轮返回瓦莱塔，黄昏时可在城门和 Triton Fountain 一带拍夜景。`
      },
      {
        time: "19:00",
        html: `晚餐备选 1：再次到 <a href="https://www.google.com/maps/search/?api=1&query=Rampila+Restaurant+Valletta" target="_blank" rel="noopener noreferrer">Rampila</a> 或其他喜欢的餐厅轻松吃一餐。`
      }
    ],

    "2025-12-26": [
      {
        time: "10:30",
        html: `从 <a href="https://www.google.com/maps/search/?api=1&query=Domus+Zamittello+Valletta" target="_blank" rel="noopener noreferrer">Domus Zamittello</a> 打车前往 <a href="https://www.google.com/maps/search/?api=1&query=Mdina+Gate+Malta" target="_blank" rel="noopener noreferrer">Mdina Gate</a>（Mdina 古城城门）。车程约20–25分钟，费用约€20。`
      },
      {
        time: "11:00",
        html: `进入 <a href="https://www.google.com/maps/search/?api=1&query=Mdina+Old+City+Malta" target="_blank" rel="noopener noreferrer">Mdina</a> 古城，沿主街和城墙慢慢参观（建议留意 <a href="https://www.google.com/maps/search/?api=1&query=St+Paul%27s+Cathedral+Mdina" target="_blank" rel="noopener noreferrer">St Paul's Cathedral</a> 开放时间）。`
      },
      {
        time: "13:00",
        html: `午餐备选 1：<a href="https://www.google.com/maps/search/?api=1&query=Fontanella+Tea+Garden+Mdina" target="_blank" rel="noopener noreferrer">Fontanella Tea Garden</a> —— 以蛋糕和城墙景观著名；步行即可到达；谷歌评分约4.4★；人均约€15–25。`
      },
      {
        time: "13:01",
        html: `午餐备选 2：<a href="https://www.google.com/maps/search/?api=1&query=de+Mondion+Mdina" target="_blank" rel="noopener noreferrer">de Mondion</a> —— Mdina 顶楼景观餐厅，米其林一星（价格较高）；需提前预订；人均€120+。`
      },
      {
        time: "14:30",
        html: `午餐后步行前往 <a href="https://www.google.com/maps/search/?api=1&query=Rabat+Malta" target="_blank" rel="noopener noreferrer">Rabat</a> 小镇（约10分钟），可选参观地窟或在咖啡馆简单休息。`
      },
      {
        time: "16:15",
        html: `从 Mdina/Rabat 打车前往 <a href="https://www.google.com/maps/search/?api=1&query=Verdala+Palace+Buskett+Gardens" target="_blank" rel="noopener noreferrer">Verdala Palace / Buskett Gardens</a> 参加 Magical Illuminated Trail 彩灯步道，车程约10–15分钟，费用约€15。`
      },
      {
        time: "17:00",
        html: `在 Verdala 宫花园内体验 Magical Illuminated Trail 灯光步道，预计游览时间60–90分钟（需要提前在官网购票并选择时间段）。`
      },
      {
        time: "18:30",
        html: `打车返回瓦莱塔，车程约25–30分钟，费用约€25。晚餐可在老城附近随意选择轻松一点的餐厅。`
      }
    ],

    "2025-12-27": [
      {
        time: "10:30",
        html: `从酒店打车前往 <a href="https://www.google.com/maps/search/?api=1&query=Blue+Grotto+Malta" target="_blank" rel="noopener noreferrer">Blue Grotto</a>（蓝洞），车程约25分钟，费用约€25。`
      },
      {
        time: "11:00",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Blue+Grotto+Malta" target="_blank" rel="noopener noreferrer">Blue Grotto</a> 乘船进入海蚀洞群（视当日海况开放而定），船程约20–25分钟。`
      },
      {
        time: "11:45",
        html: `在蓝洞观景台拍照，欣赏海岸线，停留约30分钟。`
      },
      {
        time: "12:15",
        html: `从蓝洞打车前往 <a href="https://www.google.com/maps/search/?api=1&query=Hagar+Qim+Temples+Malta" target="_blank" rel="noopener noreferrer">Ħaġar Qim & Mnajdra Temples</a> 巨石神庙群，车程约5–10分钟，费用约€10。`
      },
      {
        time: "12:30",
        html: `参观游客中心和神庙遗址，建议预留90分钟左右（注意冬季关闭时间较早）。`
      },
      {
        time: "14:00",
        html: `从神庙打车前往渔村 <a href="https://www.google.com/maps/search/?api=1&query=Marsaxlokk+Malta" target="_blank" rel="noopener noreferrer">Marsaxlokk</a>，车程约20分钟，费用约€20。`
      },
      {
        time: "14:30",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Marsaxlokk+Harbour" target="_blank" rel="noopener noreferrer">Marsaxlokk Harbour</a> 海湾散步，看传统彩色渔船。`
      },
      {
        time: "14:45",
        html: `午餐备选 1：<a href="https://www.google.com/maps/search/?api=1&query=Tartarun+Restaurant+Marsaxlokk" target="_blank" rel="noopener noreferrer">Tartarun</a> —— 海鲜为主；步行约3–5分钟；谷歌评分约4.5★；人均约€35–45。`
      },
      {
        time: "14:46",
        html: `午餐备选 2：<a href="https://www.google.com/maps/search/?api=1&query=Roots+Restaurant+Marsaxlokk" target="_blank" rel="noopener noreferrer">Roots</a> —— 本地海鲜餐厅；步行约3–5分钟；谷歌评分约4.5★；人均约€30–40。`
      },
      {
        time: "17:00",
        html: `打车返回瓦莱塔，车程约25分钟，费用约€25。晚上自由安排，可在老城找一家简单餐厅、早点休息。`
      }
    ],

    "2025-12-28": [
      {
        time: "10:30",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Domus+Zamittello+Valletta" target="_blank" rel="noopener noreferrer">Domus Zamittello</a> 办理退房，乘出租车前往新酒店 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott Resort & Spa</a>（Balluta Bay）。车程约20分钟，费用约€15–20。`
      },
      {
        time: "11:00",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott Resort & Spa</a> 办理入住或寄存行李，稍作休息。`
      },
      {
        time: "11:30",
        html: `从酒店出门，沿 Balluta Bay 海湾步道向 <a href="https://www.google.com/maps/search/?api=1&query=Sliema+Seafront" target="_blank" rel="noopener noreferrer">Sliema</a> 方向散步，一路都是海景，单程步行约30–40分钟。`
      },
      {
        time: "13:00",
        html: `午餐备选 1（Balluta Bay 附近）：<a href="https://www.google.com/maps/search/?api=1&query=Wigi%27s+Kitchen+St+Julian%27s" target="_blank" rel="noopener noreferrer">Wigi's Kitchen</a> —— 本地高分小馆，地中海 / 海鲜；离酒店步行约5分钟；谷歌评分约4.8★；人均约€35–45（建议预订）。`
      },
      {
        time: "13:01",
        html: `午餐备选 2：<a href="https://www.google.com/maps/search/?api=1&query=U+Bistrot+Balluta+Bay" target="_blank" rel="noopener noreferrer">U Bistrot</a> —— 早午餐 / 欧式餐点；步行约3–5分钟；谷歌评分约4.5★；人均约€20–30。`
      },
      {
        time: "15:00",
        html: `午后可回酒店休息，享受 SPA 或室内泳池，调整节奏。`
      },
      {
        time: "20:00",
        html: `夜间可在 <a href="https://www.google.com/maps/search/?api=1&query=Spinola+Bay+St+Julian%27s" target="_blank" rel="noopener noreferrer">Spinola Bay</a> 和 <a href="https://www.google.com/maps/search/?api=1&query=Paceville+St+Julian%27s" target="_blank" rel="noopener noreferrer">Paceville</a> 一带轻松体验圣朱利安斯的夜生活：先沿海湾散步，再挑一两家酒吧喝一杯，步行往返即可。`
      }
    ],

    "2025-12-29": [
      {
        time: "08:30",
        html: `从 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott</a> 乘出租车前往北端渡轮港 <a href="https://www.google.com/maps/search/?api=1&query=Cirkewwa+Ferry+Terminal+Malta" target="_blank" rel="noopener noreferrer">Ċirkewwa Ferry Terminal</a>，车程约30–35分钟，费用约€30–35。`
      },
      {
        time: "09:15",
        html: `从 <a href="https://www.google.com/maps/search/?api=1&query=Cirkewwa+Ferry+Terminal+Malta" target="_blank" rel="noopener noreferrer">Ċirkewwa</a> 乘 Gozo 渡轮前往 <a href="https://www.google.com/maps/search/?api=1&query=Mgarr+Harbour+Gozo" target="_blank" rel="noopener noreferrer">Mgarr Harbour (Gozo)</a>，船程约25分钟，步行乘客往返船票约€5。`
      },
      {
        time: "09:45",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Mgarr+Harbour+Gozo" target="_blank" rel="noopener noreferrer">Mgarr</a> 码头乘出租车前往 <a href="https://www.google.com/maps/search/?api=1&query=Victoria+Gozo" target="_blank" rel="noopener noreferrer">Victoria (Rabat, Gozo)</a>，车程约15分钟，费用约€12–15。`
      },
      {
        time: "10:00",
        html: `参观 <a href="https://www.google.com/maps/search/?api=1&query=Cittadella+Gozo" target="_blank" rel="noopener noreferrer">Cittadella</a>（Citadel 要塞）及周边老城街区，建议预留约2小时。`
      },
      {
        time: "12:30",
        html: `午餐备选 1（Victoria）：<a href="https://www.google.com/maps/search/?api=1&query=Ta%27+Rikardu+Gozo" target="_blank" rel="noopener noreferrer">Ta' Rikardu</a> —— 传统戈佐菜；步行可达；谷歌评分约4.5★；人均约€25–35。`
      },
      {
        time: "12:31",
        html: `午餐备选 2：<a href="https://www.google.com/maps/search/?api=1&query=Brookies+Restaurant+Gozo" target="_blank" rel="noopener noreferrer">Brookies</a> —— 山坡景观餐厅；从 Citadella 步行约10–15分钟或短途打车；谷歌评分约4.5★；人均约€30–40。`
      },
      {
        time: "14:00",
        html: `午餐后乘出租车前往 <a href="https://www.google.com/maps/search/?api=1&query=Dwejra+Bay+Gozo" target="_blank" rel="noopener noreferrer">Dwejra Bay</a>，车程约20分钟，费用约€15–20。`
      },
      {
        time: "14:20",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Dwejra+Bay+Gozo" target="_blank" rel="noopener noreferrer">Dwejra</a> 区域散步，看 Azure Window 遗址海岸、Inland Sea 内海等，预留约1.5小时。`
      },
      {
        time: "16:00",
        html: `乘出租车前往 <a href="https://www.google.com/maps/search/?api=1&query=Ghajnsielem+Gozo" target="_blank" rel="noopener noreferrer">Għajnsielem</a> 的 Bethlehem f’ Għajnsielem 仿真圣诞村所在的 Ta' Passi Fields，车程约20–25分钟，费用约€15–20。`
      },
      {
        time: "16:30",
        html: `在 Bethlehem f’ Għajnsielem 圣诞村游览，体验“真人版”伯利恒村庄布景与表演，预计停留2小时左右（具体开放日和时间以当年官网为准）。`
      },
      {
        time: "19:00",
        html: `从 Ta' Passi Fields 步行或短途打车回 <a href="https://www.google.com/maps/search/?api=1&query=Mgarr+Harbour+Gozo" target="_blank" rel="noopener noreferrer">Mgarr Harbour</a>，乘渡轮返回 <a href="https://www.google.com/maps/search/?api=1&query=Cirkewwa+Ferry+Terminal+Malta" target="_blank" rel="noopener noreferrer">Ċirkewwa</a>。`
      },
      {
        time: "19:45",
        html: `从 Ċirkewwa 打车返回 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott</a>，车程约30–35分钟，费用约€30–35。`
      }
    ],

    "2025-12-30": [
      {
        time: "09:00",
        html: `从 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott</a> 打车前往 <a href="https://www.google.com/maps/search/?api=1&query=Cirkewwa+Ferry+Terminal+Malta" target="_blank" rel="noopener noreferrer">Ċirkewwa</a>，车程约30–35分钟，费用约€30–35。`
      },
      {
        time: "09:45",
        html: `从 Ċirkewwa 搭乘小船前往 <a href="https://www.google.com/maps/search/?api=1&query=Blue+Lagoon+Comino+Malta" target="_blank" rel="noopener noreferrer">Blue Lagoon (Comino)</a>，船程约20–25分钟，往返船票约€10–15（具体以船公司公布为准）。`
      },
      {
        time: "10:15",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Blue+Lagoon+Comino+Malta" target="_blank" rel="noopener noreferrer">Blue Lagoon</a> 一带徒步、拍照，冬季不一定下水，注意防风保暖。预留约2.5–3小时。`
      },
      {
        time: "13:15",
        html: `乘小船返回 <a href="https://www.google.com/maps/search/?api=1&query=Cirkewwa+Ferry+Terminal+Malta" target="_blank" rel="noopener noreferrer">Ċirkewwa</a>。`
      },
      {
        time: "13:30",
        html: `从 Ċirkewwa 乘出租车前往 <a href="https://www.google.com/maps/search/?api=1&query=Popeye+Village+Malta" target="_blank" rel="noopener noreferrer">Popeye Village</a>（大力水手村），车程约10–15分钟，费用约€15。`
      },
      {
        time: "13:45",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Popeye+Village+Malta" target="_blank" rel="noopener noreferrer">Popeye Village</a> 内参观电影场景、拍照，欣赏海湾景色，预留约2小时。`
      },
      {
        time: "16:00",
        html: `从 Popeye Village 乘出租车返回 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott</a>，车程约35–40分钟，费用约€30–35。`
      },
      {
        time: "19:30",
        html: `晚餐备选 1：<a href="https://www.google.com/maps/search/?api=1&query=Wigi%27s+Kitchen+St+Julian%27s" target="_blank" rel="noopener noreferrer">Wigi's Kitchen</a>（如尚未光顾）或附近其他自己感兴趣的餐厅，晚餐后早些休息，为31日跨年蓄力。`
      }
    ],

    "2025-12-31": [
      {
        time: "10:30",
        html: `在酒店享用轻松的早餐或 Brunch，上午不安排长途行程，可在 Balluta Bay 一带散步、喝咖啡。`
      },
      {
        time: "14:30",
        html: `从 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott</a> 打车前往瓦莱塔老城（City Gate 附近），车程约15–20分钟，费用约€15–20。`
      },
      {
        time: "15:00",
        html: `在瓦莱塔老城随意走一走，顺便提前感受跨年布置与氛围。`
      },
      {
        time: "16:00",
        html: `在 <a href="https://www.google.com/maps/search/?api=1&query=Legligin+Wine+Bar+Valletta" target="_blank" rel="noopener noreferrer">Legligin</a> 享用早场晚餐（已预订 16:00），以马耳他式多道小盘 Tasting Menu 为主，预计用餐至18:00左右，人均约€40–50。`
      },
      {
        time: "18:00",
        html: `晚餐后可在老城周边的咖啡馆或酒吧坐一会儿，期间也可以回酒店附近找个安静角落休息，视体力情况而定。`
      },
      {
        time: "20:30",
        html: `前往 <a href="https://www.google.com/maps/search/?api=1&query=St+George%27s+Square+Valletta" target="_blank" rel="noopener noreferrer">St George's Square</a> 参加瓦莱塔跨年主舞台庆典，建议提前到场找到视野和进出路线都比较好的位置。`
      },
      {
        time: "23:50",
        html: `随着现场音乐和灯光一起倒数迎接新年，0点时可以抬头观看 Grand Harbour 上空的烟花秀（可视当晚人流适当调整观赏点）。`
      },
      {
        time: "00:30",
        html: `活动结束后，从城门外或 Floriana 一带乘出租车返回 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott</a>，车程约20–30分钟，费用约€25–35（跨年夜打车需求较多，可能需要等待）。`
      }
    ],

    "2026-01-01": [
      {
        time: "10:30",
        html: `新年早上晚起，在酒店悠闲吃早餐，完全放松不赶行程。`
      },
      {
        time: "12:00",
        html: `可选择在 <a href="https://www.google.com/maps/search/?api=1&query=Balluta+Bay+Malta" target="_blank" rel="noopener noreferrer">Balluta Bay</a> 和 <a href="https://www.google.com/maps/search/?api=1&query=Sliema+Seafront" target="_blank" rel="noopener noreferrer">Sliema Seafront</a> 一带散步，慢慢走到 Sliema 再打车/乘公交回酒店。`
      },
      {
        time: "13:00",
        html: `午餐备选 1：<a href="https://www.google.com/maps/search/?api=1&query=Peperoncino+Restaurant+St+Julian%27s" target="_blank" rel="noopener noreferrer">Peperoncino</a> —— 意大利 / 地中海菜；距酒店步行约8–10分钟；谷歌评分约4.5★；人均约€30–40。`
      },
      {
        time: "13:01",
        html: `午餐备选 2：<a href="https://www.google.com/maps/search/?api=1&query=Zeri%27s+Restaurant+St+Julian%27s" target="_blank" rel="noopener noreferrer">Zeri's Restaurant</a> —— 海鲜与牛排；在 Portomaso 一带；从酒店步行约15–20分钟或短途打车；谷歌评分约4.5★；人均约€35–45。`
      },
      {
        time: "19:30",
        html: `晚餐后可再轻度体验一次圣朱利安斯夜生活：在 Balluta/Spinola Bay 找一间喜欢的酒吧坐坐，或者去 <a href="https://www.google.com/maps/search/?api=1&query=Paceville+St+Julian%27s" target="_blank" rel="noopener noreferrer">Paceville</a> 主街逛逛，感受不同的新年气氛，尽量不要玩到太晚，以免影响第二天早班机。`
      }
    ],

    "2026-01-02": [
      {
        time: "06:30",
        html: `从 <a href="https://www.google.com/maps/search/?api=1&query=Malta+Marriott+Resort+%26+Spa+Balluta+Bay" target="_blank" rel="noopener noreferrer">Malta Marriott</a> 办理退房，乘出租车前往 <a href="https://www.google.com/maps/search/?api=1&query=Malta+International+Airport" target="_blank" rel="noopener noreferrer">Malta International Airport</a>，车程约20–25分钟，费用约€20–25。`
      },
      {
        time: "07:00",
        html: `抵达机场，办理登机手续与托运行李，预留充足时间通过安检。航班：卡塔尔航空 QR382，起飞时间 09:20。`
      }
    ]
  };

  // ====== 额外景点备选数据 ======
  const extraSpotsData = {
    "2025-12-23": [
      {
        name: "国家考古博物馆 National Museum of Archaeology",
        url: "https://www.google.com/maps/search/?api=1&query=National+Museum+of+Archaeology+Valletta",
        info: "成人门票约 €5，步行距酒店约3–5分钟，建议预留 60–90 分钟，可系统看一遍马耳他史前文明与巨石神庙背景。"
      },
      {
        name: "圣埃尔莫堡 & 国家战争博物馆 Fort St Elmo",
        url: "https://www.google.com/maps/search/?api=1&query=Fort+St+Elmo+National+War+Museum+Valletta",
        info: "成人门票约 €10，建议预留 1.5–2 小时，可从骑士团到二战的防御历史，一并带上港口全景。"
      }
    ],
    "2025-12-24": [
      {
        name: "三姐妹城深度小巷散步",
        url: "https://www.google.com/maps/search/?api=1&query=Vittoriosa+Birgu+Malta",
        info: "如果下午体力不错，可在 Birgu 再多走 60–90 分钟，钻进后街看本地居民区、洗衣绳和小广场，比主街更日常。"
      },
      {
        name: "海军博物馆 Malta Maritime Museum",
        url: "https://www.google.com/maps/search/?api=1&query=Malta+Maritime+Museum+Birgu",
        info: "位于码头古建筑内，成人票价约 €7 左右，建议 60 分钟，可了解马耳他与地中海航海史。"
      }
    ],
    "2025-12-25": [
      {
        name: "瓦莱塔海军堡垒区 Fort St Elmo 外观",
        url: "https://www.google.com/maps/search/?api=1&query=Fort+St+Elmo+Valletta",
        info: "圣诞当天如不进馆，可仅在外墙和海角处散步 30–40 分钟，远眺海港和灯塔。"
      },
      {
        name: "Sliema 海滨长廊延伸散步",
        url: "https://www.google.com/maps/search/?api=1&query=Sliema+Seafront",
        info: "如果天气好，可以从渡轮站一路沿海走到塔路方向，来回 60–90 分钟，是最当地的散步路线之一。"
      }
    ],
    "2025-12-26": [
      {
        name: "圣保禄地下墓穴 St Paul's Catacombs",
        url: "https://www.google.com/maps/search/?api=1&query=St+Paul%27s+Catacombs+Rabat+Malta",
        info: "成人门票约 €5，建议预留 60–90 分钟，地处 Rabat，和 Mdina 一起安排刚好。注意部分通道较低。"
      }
    ],
    "2025-12-27": [
      {
        name: "Ħaġar Qim 周边海岸步道",
        url: "https://www.google.com/maps/search/?api=1&query=Hagar+Qim+Viewpoint+Malta",
        info: "如果风不大，可在神庙下方沿悬崖步道多走 30–45 分钟，看海岸线和小岛 Filfla，不额外收费。"
      }
    ],
    "2025-12-28": [
      {
        name: "Balluta Bay 全湾散步",
        url: "https://www.google.com/maps/search/?api=1&query=Balluta+Bay+Malta",
        info: "从酒店沿海湾绕一整圈大约 30 分钟，顺便从不同角度拍新哥特式教堂和湾区建筑。"
      },
      {
        name: "Carmelite Church Balluta 外观",
        url: "https://www.google.com/maps/search/?api=1&query=Carmelite+Church+Balluta",
        info: "教堂内部开放时间不稳定，但外立面非常上镜，可在黄昏时专门过去拍照 10–15 分钟。"
      }
    ],
    "2025-12-29": [
      {
        name: "Cittadella 内部免费城墙环走",
        url: "https://www.google.com/maps/search/?api=1&query=Cittadella+Gozo",
        info: "大部分城墙步道开放，建议多预留 30–40 分钟在城墙上环走一圈，从不同方向俯瞰整座戈佐岛。"
      }
    ],
    "2025-12-30": [
      {
        name: "Comino 圣玛利亚塔楼 St Mary's Tower 远观",
        url: "https://www.google.com/maps/search/?api=1&query=St+Mary%27s+Tower+Comino",
        info: "部分船公司行程会在远处绕行塔楼，如天气良好可和船公司确认路线，多拍几张照片。"
      }
    ],
    "2025-12-31": [
      {
        name: "总团长宫 Grandmaster's Palace 外观",
        url: "https://www.google.com/maps/search/?api=1&query=Grandmaster%27s+Palace+Valletta",
        info: "就在圣乔治广场边上，可提前 20–30 分钟到附近，看修复后的立面细节和阳台，非常有气氛。"
      }
    ],
    "2026-01-01": [
      {
        name: "Sliema → St Julian's 海岸线长距离散步",
        url: "https://www.google.com/maps/search/?api=1&query=Sliema+to+St+Julian%27s+promenade",
        info: "如果元旦体力尚可，可以从 Sliema 沿海一路走回 Balluta / Spinola，单程 45–60 分钟，沿途咖啡馆很多。"
      }
    ]
  };

  // ====== 历史背景简介数据（主页面简版，150–200 字左右） ======
  const historyData = {
    "2025-12-22": [
      {
        title: "瓦莱塔老城 Valletta",
        link: "hist_valletta.html",
        text: "瓦莱塔是在 1565 年大围攻之后，由圣约翰骑士团在一片狭长半岛上整体规划的新都城，街道呈棋盘格，城墙层层包围，被联合国教科文组织称为“世界上最集中密集的历史城区之一”。今天的一公里见方里塞进了宫殿、旅馆、教堂、剧院和防御工事，既是军事要塞也是行政与宗教中心，你们第一晚在老城里随便走一圈，其实就是在一座“开放式历史博物馆”里散步。"
      },
      {
        title: "上巴拉卡花园与大港",
        link: "hist_upper_barrakka.html",
        text: "上巴拉卡花园原本是意大利骑士的私人花园，后来在英属时期改为公共空间。这里位于南侧城墙最高处，可以一眼望到 Grand Harbour 与对岸三姐妹城，是瓦莱塔最经典的观景台。每天中午的礼炮展示源自旧时的港口报时传统，如今更多是仪式感和观光功能。你们从这里俯瞰整片港口，就能直观看到马耳他“军港之城”的格局。"
      }
    ],
    "2025-12-23": [
      {
        title: "圣约翰副主教座堂 St John’s Co‑Cathedral",
        link: "hist_st_johns.html",
        text: "这座教堂外墙极为低调，内部却是欧洲高巴洛克艺术的代表作。它建于 16 世纪后期，作为骑士团在新都的会堂教堂。后来由画家马蒂亚·普雷蒂主导改造，几乎所有墙面和拱顶都被雕刻与壁画覆盖，地板则由四百多块大理石墓碑组成，埋葬着高级骑士与重要人物。侧礼拜堂中收藏的卡拉瓦乔名作《圣约翰的斩首》被许多人视为他生涯最高成就之一。"
      },
      {
        title: "国家考古博物馆",
        link: "hist_arch_museum.html",
        text: "国家考古博物馆位于共和国大街上一座原骑士旅馆内，集中展示马耳他从新石器时代到早期腓尼基时期的重要文物。这里可以看到“肥女神”“睡美人”等著名雕像，以及巨石神庙的模型和出土器物。先在这里快速浏览一遍，会对之后前往 Ħaġar Qim、Mnajdra 等遗址时看到的建筑结构、祭坛和雕像有更清晰的背景，对整个行程的历史理解很有帮助。"
      }
    ],
    "2025-12-24": [
      {
        title: "三姐妹城 Birgu · Senglea · Cospicua",
        link: "",
        text: "面对瓦莱塔、伸入大港的三块半岛上，分别坐落着 Birgu（Vittoriosa）、Senglea 和 Cospicua，合称“三姐妹城”。骑士团抵达马耳他初期，曾以 Birgu 为首都并加强这里的堡垒体系，后来又修建 Cottonera 防线环抱三城，使其成为防御体系的前线。与瓦莱塔的棋盘格相比，三姐妹城保留了更多中世纪街巷的随意和生活气息，晾衣绳、小神龛和本地人的阳台是这里真正的主角。"
      },
      {
        title: "Fort St Angelo 圣安杰洛堡",
        link: "",
        text: "圣安杰洛堡位于 Birgu 半岛尖端，被视为控制整个 Grand Harbour 的关键据点。大围攻期间，这里承受了大量火力却始终未被攻破，因此在马耳他记忆中具有象征意义。英国和后来的马耳他海军也长期把重要设施布置在附近。你们在码头边散步、从不同角度观看堡垒时，可以想象几百年前这里布满火炮的场景。"
      }
    ],
    "2025-12-25": [
      {
        title: "瓦莱塔的圣诞传统",
        link: "hist_valletta.html",
        text: "马耳他的圣诞结合了天主教传统与地中海式热情。瓦莱塔及周边城镇会搭建各种规模的马槽场景（Presepju），从教堂内精致模型到居民在窗边摆出的小装饰不一而足。圣诞夜和圣诞节当天，家庭聚餐和弥撒是主角，很多商铺会缩短营业时间。你们这天在老城和港口附近随意漫步，感受的更多是本地人自己的节日氛围，而不是“景点打卡”。"
      },
      {
        title: "Sliema 海滨长廊",
        link: "hist_sliema_seafront.html",
        text: "Sliema 原本只是瓦莱塔对岸的渔村，英属时期逐渐发展成别墅和海滨长廊云集的度假小镇。如今这里高层住宅和酒店林立，但三公里左右的海边步道仍然是当地人最爱散步、跑步和遛狗的地方之一。圣诞当天从瓦莱塔乘渡轮过来，在海边慢慢走一圈，能看到马耳他人在“普通节日的一天”里最真实的生活节奏。"
      }
    ],
    "2025-12-26": [
      {
        title: "Mdina 静城",
        link: "hist_mdina.html",
        text: "Mdina 所在的高地自青铜时代就有人居住，后来成为腓尼基与罗马城市 Melite 的一部分。中世纪时这里是马耳他贵族和主教的权力中心，城内街道狭窄而安静，车辆极少出入，因此有“Silent City 静城”的昵称。骑士团把重心转移到港口后，这里人口减少但贵族宅邸仍被家族继承保存，如今在金色石墙和阳台之间散步，会有一种被时间包裹的感觉。"
      },
      {
        title: "Verdala 宫与 Buskett 林地",
        link: "hist_verdala_buskett.html",
        text: "Verdala 宫始建于 16 世纪末，前身是骑士团用于狩猎的乡间别墅。后来这里既当过总督夏季官邸，也充当过战俘营，如今是马耳他总统的夏季住所，一般不常对公众开放。宫殿周围的 Buskett 花园是岛上少见的自然林地，过去用于打猎和农耕，现在则变成散步、节庆活动的场所，冬季的灯光步道让严肃的历史场所多了一层童话感。"
      }
    ],
    "2025-12-27": [
      {
        title: "蓝洞 Blue Grotto",
        link: "hist_blue_grotto.html",
        text: "马耳他蓝洞是一串海蚀洞群的总称，而非单一洞穴，位于南岸 Qrendi 一带的悬崖之下，对面是无人小岛 Filfla。阳光在不同角度照进洞中时，海水和石灰岩内壁会反射出层次丰富的蓝色和青绿色，因此非常适合清晨或中午前后乘船进入。即便因风浪无法乘船，从观景台俯瞰整个海岬与拱门，也是非常有代表性的海岸风景。"
      },
      {
        title: "Ħaġar Qim & Mnajdra 巨石神庙",
        link: "hist_hagar_qim_mnajdra.html",
        text: "Ħaġar Qim 与 Mnajdra 神庙修建于公元前 4 千纪，是世界上最古老的独立石构宗教建筑之一，被列入“马耳他巨石神庙群”世界遗产。神庙以巨大的石块围出房室与祭坛，其中 Mnajdra 中央神庙入口还与春分、夏至日出的方位对齐，被视为兼具宗教和“太阳历法”功能的场所。站在面对大海的坡地上，很容易想象远古岛民如何在这里观察天空并举行仪式。"
      }
    ],
    "2025-12-28": [
      {
        title: "Balluta Bay 与圣朱利安斯",
        link: "hist_balluta_st_julians.html",
        text: "圣朱利安斯起初只是渔村和乡间别墅区，十九、二十世纪之交随着英国驻军与本地中产的增加，逐渐发展成海边度假与居住混合的小城。Balluta Bay 的天际线由新哥特式加尔默罗教堂和 Art Nouveau 公寓楼主导，周围则是咖啡馆和餐厅。往北一点的 Paceville 是夜店和酒吧最集中的区域，你们住在 Balluta，一边是相对安静的海湾生活，一边步行十几分钟就能进入最热闹的夜生活区。"
      },
      {
        title: "Sliema 海滨长廊",
        link: "hist_sliema_seafront.html",
        text: "Sliema 在英属时期成为高级住宅和海滨散步道聚集地，后来经历了快速城市化，大量旧别墅被公寓取代。尽管建筑风格颇受争议，三公里左右的海滨长廊依然是岛上最有人气的公共空间之一。你们从 Balluta 沿海走到 Sliema，再从另一侧返回，相当于完整体验了一遍当地居民的日常散步路线。"
      }
    ],
    "2025-12-29": [
      {
        title: "戈佐城堡 Cittadella",
        link: "hist_cittadella.html",
        text: "Cittadella 坐落在戈佐岛维多利亚镇的山丘之巅，自青铜时代起就有防御性聚落，后来成为腓尼基、罗马和中世纪城市的卫城。骑士团时期，岛民在遇到海盗或敌船威胁时必须夜间留宿城堡，因此这里长期承担“最后避风港”的作用。1551 年的入侵中，城堡被攻破、数千居民被掳为奴，这段创伤一直烙在当地记忆里。修复后的城墙与教堂如今向游客开放，从城墙环走一圈就像翻阅压缩在一块石头山上的小岛史。"
      },
      {
        title: "Bethlehem f’ Għajnsielem 仿真圣诞村",
        link: "hist_bethlehem_ghajnsielem.html",
        text: "Bethlehem f’ Għajnsielem 是戈佐岛上极具地方特色的圣诞活动，每年圣诞季村旁的田地会被布置成一世纪伯利恒小镇：木匠铺、铁匠、牧羊人、集市和马槽都由当地居民扮演，配合真实牲畜和手工制品。对社区来说，这是跨世代共同参与的项目；对游客来说，则像走进一部慢节奏的真人历史片，在篝火和灯光之间观察一个小岛如何用自己的方式延续宗教与家庭传统。"
      }
    ],
    "2025-12-30": [
      {
        title: "Comino 岛与蓝礁湖 Blue Lagoon",
        link: "hist_comino_blue_lagoon.html",
        text: "Comino 位于马耳他与戈佐之间，长期人口稀少，曾被用作流放地和海防哨所。岛上最显眼的圣玛利亚塔楼是 17 世纪骑士团防御体系的一部分。蓝礁湖位于 Comino 与小岛 Cominotto 之间，白沙浅水与石灰岩反射形成夸张的蓝绿色，因电影取景和社交媒体而爆红。近年来由于过度拥挤，当局开始限制每日游客数量、调整船只停泊，以在观光和自然保护之间寻找平衡。"
      },
      {
        title: "Popeye Village 大力水手村",
        link: "hist_popeye_village.html",
        text: "大力水手村本是 1980 年好莱坞音乐电影《Popeye》的外景地，剧组在海湾边搭起夸张的木质小镇：主角的小屋、酒馆、码头和杂货店都忠于卡通风格。电影杀青后布景并未拆除，而是被逐步改造为以家庭游客为主的主题村，加入轻松的表演和简单游乐项目。对影迷来说，这里是“穿越进电影画面”的现场；对其他游客而言，这片彩色木屋与碧绿海湾本身就足够上镜。"
      }
    ],
    "2025-12-31": [
      {
        title: "圣乔治广场与总团长宫",
        link: "hist_st_georges_square_nye.html",
        text: "圣乔治广场处在瓦莱塔几何中心，一侧是曾经的骑士团总团长宫殿、后来英属总督府，如今是总统办公室和重要国家机构所在地，几百年来一直是政治与仪式活动的核心空间。另一侧则是国家图书馆等历史建筑。每逢国庆、大型庆典和跨年，这里会搭建舞台和观众区，把原本象征权力的石头广场变成城市客厅，让市民和游客一起在灯光与音乐中占据这个空间。"
      }
    ],
    "2026-01-01": [
      {
        title: "Sliema 海滨长廊的日常",
        link: "hist_sliema_seafront.html",
        text: "Sliema 在英属时期发展成海边别墅区和外籍社群聚居地，后来大规模公寓建设让海滨天际线发生巨大变化。尽管如此，长长的海边步道仍然是马耳他人日常生活的重要背景：清晨跑步、下午遛狗、傍晚全家一起散步、夜晚年轻人在长椅上聊天。元旦这天你们沿着海边慢慢走，很容易在不经意间捕捉到本地居民“小岛日常”的细节。"
      },
      {
        title: "Balluta & St Julian’s 夜生活与海湾",
        link: "hist_balluta_st_julians.html",
        text: "圣朱利安斯从渔村变成夜生活中心的过程，也折射出马耳他旅游业的发展：渔船与传统房屋逐渐被餐厅、酒店和酒吧取代。Balluta Bay 保留了更多混合生活气息，一边是当地居民和长住外籍人士，另一边是来度假的旅客。往北的 Paceville 则是通宵夜店和酒吧区。元旦这天如果不想挤大场面，可以只在海湾两侧慢慢走、找一家安静的酒吧坐坐，用很轻松的方式和这座海边小城告别。"
      }
    ]
  };

  // ====== 语音朗读（历史背景 & 额外信息可用） ======
  let voices = [];

  function loadVoices() {
    if (!('speechSynthesis' in window)) return;
    voices = window.speechSynthesis.getVoices() || [];
  }

  if ('speechSynthesis' in window) {
    loadVoices();
    window.speechSynthesis.onvoiceschanged = loadVoices;
  }

  function speakText(text) {
    if (!('speechSynthesis' in window)) {
      alert('当前浏览器不支持语音朗读，可以直接阅读文字。');
      return;
    }
    window.speechSynthesis.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = 'zh-CN';

    let zhVoice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith('zh'));
    if (!zhVoice) {
      zhVoice = voices.find(v => v.lang && v.lang.toLowerCase().includes('zh-cn'));
    }
    if (zhVoice) {
      utter.voice = zhVoice;
    } else if (voices.length > 0) {
      utter.voice = voices[0];
    }
    window.speechSynthesis.speak(utter);
  }

  function stopSpeak() {
    if ('speechSynthesis' in window) {
      window.speechSynthesis.cancel();
    }
  }

  // 播放当天所有历史背景（标题+正文）
  function speakDayHistory(dateStr) {
    const items = historyData[dateStr];
    if (!items || !items.length) return;
    const text = items.map(it => it.title + "。" + it.text).join("。");
    speakText(text);
  }

  // ====== 构建 UI ======
  const dateKeys = Object.keys(itineraryData).sort();
  const buttonsContainer = document.getElementById('date-buttons');
  const itinerariesContainer = document.getElementById('itineraries');

  dateKeys.forEach(dateStr => {
    const dateObj = new Date(dateStr + 'T00:00:00');
    const label = dateObj.toLocaleDateString('zh-CN', {
      month: '2-digit',
      day: '2-digit',
      weekday: 'short'
    });

    const btn = document.createElement('button');
    btn.className = 'date-btn';
    btn.dataset.date = dateStr;
    btn.textContent = label;
    btn.addEventListener('click', () => showItinerary(dateStr));
    buttonsContainer.appendChild(btn);

    const dayDiv = document.createElement('div');
    dayDiv.id = 'itin-' + dateStr;
    dayDiv.className = 'itinerary';

    const title = document.createElement('div');
    title.className = 'day-title';
    title.textContent = dateObj.toLocaleDateString('zh-CN', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      weekday: 'long'
    });
    dayDiv.appendChild(title);

    // 时间轴
    itineraryData[dateStr].forEach(item => {
      const actDiv = document.createElement('div');
      actDiv.className = 'activity';

      const timeSpan = document.createElement('span');
      timeSpan.className = 'time';

      // 对“午餐备选 2/3”“晚餐备选 2/3”隐藏时间，只在第一行显示
      const isAltMeal = /午餐备选\s*[2-9]/.test(item.html) || /晚餐备选\s*[2-9]/.test(item.html);
      timeSpan.textContent = isAltMeal ? "" : item.time || "";
      actDiv.appendChild(timeSpan);

      const descSpan = document.createElement('span');
      descSpan.className = 'desc';
      descSpan.innerHTML = item.html;
      actDiv.appendChild(descSpan);

      dayDiv.appendChild(actDiv);
    });

    // 额外景点备选
    appendExtraSpots(dayDiv, dateStr);
    // 历史背景
    appendHistoryBlock(dayDiv, dateStr);

    itinerariesContainer.appendChild(dayDiv);
  });

  function appendExtraSpots(container, dateStr) {
    const spots = extraSpotsData[dateStr];
    if (!spots || !spots.length) return;
    const block = document.createElement('div');
    block.className = 'extra-block';

    const title = document.createElement('div');
    title.className = 'extra-title';
    title.innerHTML = `额外景点备选 <span class="hint">（如果当天精力旺盛、不想回房休息，可以加这些）</span>`;
    block.appendChild(title);

    spots.forEach(s => {
      const row = document.createElement('div');
      row.className = 'extra-item';

      const link = document.createElement('a');
      link.href = s.url;
      link.target = "_blank";
      link.rel = "noopener noreferrer";
      link.textContent = s.name;
      row.appendChild(link);

      const info = document.createElement('div');
      info.className = 'extra-text';
      info.textContent = s.info;
      row.appendChild(info);

      block.appendChild(row);
    });

    container.appendChild(block);
  }

  function appendHistoryBlock(container, dateStr) {
    const items = historyData[dateStr];
    if (!items || !items.length) return;

    const block = document.createElement('div');
    block.className = 'history-block';

    const titleRow = document.createElement('div');
    titleRow.className = 'history-title-main';
    const mainSpan = document.createElement('span');
    mainSpan.textContent = '历史背景 & 小故事';

    const btnWrap = document.createElement('span');
    btnWrap.className = 'hint';
    btnWrap.innerHTML = `
      <button class="speak-btn" onclick="speakDayHistory('${dateStr}')">▶ 播放本日全部讲解</button>
      <button class="speak-btn speak-stop" onclick="stopSpeak()">■ 停止</button>
    `;

    titleRow.appendChild(mainSpan);
    titleRow.appendChild(btnWrap);
    block.appendChild(titleRow);

    items.forEach(item => {
      const card = document.createElement('div');
      card.className = 'history-card';

      const hTitle = document.createElement('div');
      hTitle.className = 'history-title';
      hTitle.textContent = item.title;
      card.appendChild(hTitle);

      const p = document.createElement('p');
      p.className = 'history-text';
      p.textContent = item.text;
      card.appendChild(p);

      const actions = document.createElement('div');
      actions.className = 'history-actions';

      const speakBtn = document.createElement('button');
      speakBtn.className = 'speak-btn';
      speakBtn.textContent = '▶ 播放本段';
      speakBtn.addEventListener('click', () => speakText(item.text));
      actions.appendChild(speakBtn);

      const stopBtn = document.createElement('button');
      stopBtn.className = 'speak-btn speak-stop';
      stopBtn.textContent = '■ 停止';
      stopBtn.addEventListener('click', stopSpeak);
      actions.appendChild(stopBtn);

      if (item.link) {
        const more = document.createElement('a');
        more.className = 'detail-link';
        more.href = item.link;
        more.target = "_blank";
        more.rel = "noopener noreferrer";
        more.textContent = '查看详细介绍 ›';
        actions.appendChild(more);
      }

      card.appendChild(actions);
      block.appendChild(card);
    });

    container.appendChild(block);
  }

  function showItinerary(dateStr) {
    dateKeys.forEach(d => {
      const div = document.getElementById('itin-' + d);
      if (div) div.classList.remove('active');
      const b = document.querySelector('.date-btn[data-date="' + d + '"]');
      if (b) b.classList.remove('active');
    });
    const activeDiv = document.getElementById('itin-' + dateStr);
    if (activeDiv) activeDiv.classList.add('active');
    const activeBtn = document.querySelector('.date-btn[data-date="' + dateStr + '"]');
    if (activeBtn) activeBtn.classList.add('active');
  }

  // 默认显示今天，如果不在范围内则显示第一天
  (function initDefaultDay() {
    const today = new Date();
    const key = today.toISOString().slice(0, 10);
    if (itineraryData[key]) {
      showItinerary(key);
    } else {
      showItinerary(dateKeys[0]);
    }
  })();
</script>
</body>
</html>
